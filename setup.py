#!/usr/bin/env python3\n\"\"\"\nSmartclip AI Setup Script\nAutomatic installation dan setup untuk Smartclip AI\n\"\"\"\n\nimport os\nimport sys\nimport subprocess\nimport platform\nfrom pathlib import Path\nimport urllib.request\nimport zipfile\nimport shutil\n\nclass SmartclipInstaller:\n    def __init__(self):\n        self.system = platform.system()\n        self.python_version = sys.version_info\n        self.base_dir = Path(__file__).parent\n        \n    def check_requirements(self):\n        \"\"\"Check system requirements\"\"\"\n        print(\"üîç Checking system requirements...\")\n        \n        # Check Python version\n        if self.python_version < (3, 8):\n            print(f\"‚ùå Python 3.8+ required. Current: {sys.version}\")\n            return False\n            \n        print(f\"‚úÖ Python {sys.version.split()[0]}\")\n        \n        # Check available memory\n        try:\n            import psutil\n            memory_gb = psutil.virtual_memory().total / (1024**3)\n            if memory_gb < 8:\n                print(f\"‚ö†Ô∏è Warning: Low memory detected ({memory_gb:.1f}GB). 8GB+ recommended.\")\n            else:\n                print(f\"‚úÖ Memory: {memory_gb:.1f}GB\")\n        except ImportError:\n            print(\"‚ö†Ô∏è Could not check memory requirements\")\n            \n        # Check disk space\n        try:\n            free_space = shutil.disk_usage(self.base_dir).free / (1024**3)\n            if free_space < 10:\n                print(f\"‚ùå Insufficient disk space. {free_space:.1f}GB free, 10GB+ required.\")\n                return False\n            else:\n                print(f\"‚úÖ Disk space: {free_space:.1f}GB free\")\n        except Exception:\n            print(\"‚ö†Ô∏è Could not check disk space\")\n            \n        return True\n        \n    def install_pip_requirements(self):\n        \"\"\"Install Python packages dari requirements.txt\"\"\"\n        print(\"\\nüì¶ Installing Python packages...\")\n        \n        try:\n            # Upgrade pip first\n            subprocess.run([sys.executable, \"-m\", \"pip\", \"install\", \"--upgrade\", \"pip\"], \n                         check=True, capture_output=True)\n            print(\"‚úÖ Pip upgraded\")\n            \n            # Install requirements\n            requirements_file = self.base_dir / \"requirements.txt\"\n            if requirements_file.exists():\n                result = subprocess.run(\n                    [sys.executable, \"-m\", \"pip\", \"install\", \"-r\", str(requirements_file)],\n                    capture_output=True, text=True\n                )\n                \n                if result.returncode == 0:\n                    print(\"‚úÖ All packages installed successfully\")\n                    return True\n                else:\n                    print(f\"‚ùå Error installing packages: {result.stderr}\")\n                    return False\n            else:\n                print(\"‚ùå requirements.txt not found\")\n                return False\n                \n        except subprocess.CalledProcessError as e:\n            print(f\"‚ùå Error during installation: {e}\")\n            return False\n            \n    def install_system_dependencies(self):\n        \"\"\"Install system dependencies berdasarkan OS\"\"\"\n        print(\"\\nüîß Installing system dependencies...\")\n        \n        if self.system == \"Windows\":\n            return self._install_windows_deps()\n        elif self.system == \"Darwin\":  # macOS\n            return self._install_macos_deps()\n        elif self.system == \"Linux\":\n            return self._install_linux_deps()\n        else:\n            print(f\"‚ö†Ô∏è Unsupported system: {self.system}\")\n            return False\n            \n    def _install_windows_deps(self):\n        \"\"\"Install Windows dependencies\"\"\"\n        try:\n            # Check jika FFmpeg sudah installed\n            result = subprocess.run([\"ffmpeg\", \"-version\"], \n                                   capture_output=True, text=True)\n            if result.returncode == 0:\n                print(\"‚úÖ FFmpeg already installed\")\n                return True\n        except FileNotFoundError:\n            pass\n            \n        print(\"üì• Downloading FFmpeg for Windows...\")\n        \n        try:\n            # Download FFmpeg binary untuk Windows\n            ffmpeg_url = \"https://www.gyan.dev/ffmpeg/builds/ffmpeg-release-essentials.zip\"\n            ffmpeg_zip = self.base_dir / \"ffmpeg.zip\"\n            \n            urllib.request.urlretrieve(ffmpeg_url, ffmpeg_zip)\n            \n            # Extract FFmpeg\n            with zipfile.ZipFile(ffmpeg_zip, 'r') as zip_ref:\n                zip_ref.extractall(self.base_dir / \"ffmpeg\")\n                \n            # Find FFmpeg executable\n            for item in (self.base_dir / \"ffmpeg\").rglob(\"ffmpeg.exe\"):\n                ffmpeg_path = item\n                break\n                \n            # Add to PATH (for current session)\n            os.environ[\"PATH\"] += os.pathsep + str(ffmpeg_path.parent)\n            \n            # Cleanup\n            ffmpeg_zip.unlink()\n            \n            print(\"‚úÖ FFmpeg installed\")\n            print(\"‚ö†Ô∏è Note: Add FFmpeg to system PATH permanently for best experience\")\n            \n            return True\n            \n        except Exception as e:\n            print(f\"‚ùå Error installing FFmpeg: {e}\")\n            return False\n            \n    def _install_macos_deps(self):\n        \"\"\"Install macOS dependencies\"\"\"\n        try:\n            # Check homebrew\n            subprocess.run([\"brew\", \"--version\"], check=True, capture_output=True)\n            print(\"‚úÖ Homebrew detected\")\n            \n            # Install FFmpeg\n            result = subprocess.run([\"brew\", \"install\", \"ffmpeg\"], \n                                   capture_output=True, text=True)\n            if result.returncode == 0:\n                print(\"‚úÖ FFmpeg installed via Homebrew\")\n                return True\n            else:\n                print(f\"‚ùå Error installing FFmpeg: {result.stderr}\")\n                return False\n                \n        except subprocess.CalledProcessError:\n            print(\"‚ùå Homebrew not found. Please install Homebrew first:\")\n            print(\"   /bin/bash -c \\\"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)\\\"\")\n            return False\n            \n    def _install_linux_deps(self):\n        \"\"\"Install Linux dependencies\"\"\"\n        try:\n            # Try apt-get (Ubuntu/Debian)\n            result = subprocess.run([\"sudo\", \"apt\", \"update\"], \n                                   capture_output=True, text=True)\n            if result.returncode == 0:\n                subprocess.run([\"sudo\", \"apt\", \"install\", \"-y\", \"ffmpeg\", \"libgl1-mesa-glx\"], \n                              check=True)\n                print(\"‚úÖ Dependencies installed via apt\")\n                return True\n        except (subprocess.CalledProcessError, FileNotFoundError):\n            pass\n            \n        try:\n            # Try yum (CentOS/RHEL)\n            subprocess.run([\"sudo\", \"yum\", \"install\", \"-y\", \"ffmpeg\", \"mesa-libGL\"], \n                          check=True)\n            print(\"‚úÖ Dependencies installed via yum\")\n            return True\n        except (subprocess.CalledProcessError, FileNotFoundError):\n            pass\n            \n        print(\"‚ùå Could not install dependencies automatically\")\n        print(\"Please install FFmpeg manually:\")\n        print(\"  Ubuntu/Debian: sudo apt install ffmpeg\")\n        print(\"  CentOS/RHEL: sudo yum install ffmpeg\")\n        return False\n        \n    def setup_directories(self):\n        \"\"\"Setup required directories\"\"\"\n        print(\"\\nüìÅ Setting up directories...\")\n        \n        directories = ['temp', 'output', 'models', 'watermarks']\n        \n        for dir_name in directories:\n            dir_path = self.base_dir / dir_name\n            dir_path.mkdir(exist_ok=True)\n            print(f\"‚úÖ {dir_name}/ directory ready\")\n            \n        return True\n        \n    def test_installation(self):\n        \"\"\"Test jika installation berhasil\"\"\"\n        print(\"\\nüß™ Testing installation...\")\n        \n        try:\n            # Test imports\n            test_imports = [\n                'torch', 'cv2', 'numpy', 'librosa', 'whisper',\n                'face_recognition', 'moviepy', 'yt_dlp', 'customtkinter'\n            ]\n            \n            failed_imports = []\n            for module in test_imports:\n                try:\n                    __import__(module)\n                    print(f\"‚úÖ {module}\")\n                except ImportError:\n                    failed_imports.append(module)\n                    print(f\"‚ùå {module}\")\n                    \n            if failed_imports:\n                print(f\"\\n‚ùå Failed to import: {', '.join(failed_imports)}\")\n                return False\n                \n            # Test FFmpeg\n            result = subprocess.run([\"ffmpeg\", \"-version\"], \n                                   capture_output=True, text=True)\n            if result.returncode == 0:\n                print(\"‚úÖ FFmpeg\")\n            else:\n                print(\"‚ùå FFmpeg not accessible\")\n                return False\n                \n            print(\"\\nüéâ Installation test passed!\")\n            return True\n            \n        except Exception as e:\n            print(f\"‚ùå Test failed: {e}\")\n            return False\n            \n    def create_launcher_scripts(self):\n        \"\"\"Create launcher scripts untuk easy startup\"\"\"\n        print(\"\\nüöÄ Creating launcher scripts...\")\n        \n        try:\n            # Windows batch file\n            if self.system == \"Windows\":\n                batch_content = f\"\"\"@echo off\ncd /d \"{self.base_dir}\"\npython main.py\npause\n\"\"\"\n                with open(self.base_dir / \"start_smartclip.bat\", 'w') as f:\n                    f.write(batch_content)\n                print(\"‚úÖ start_smartclip.bat created\")\n                \n            # Unix shell script\n            else:\n                shell_content = f\"\"\"#!/bin/bash\ncd \"{self.base_dir}\"\npython3 main.py\n\"\"\"\n                script_path = self.base_dir / \"start_smartclip.sh\"\n                with open(script_path, 'w') as f:\n                    f.write(shell_content)\n                script_path.chmod(0o755)  # Make executable\n                print(\"‚úÖ start_smartclip.sh created\")\n                \n            return True\n            \n        except Exception as e:\n            print(f\"‚ö†Ô∏è Could not create launcher scripts: {e}\")\n            return False\n            \n    def run_setup(self):\n        \"\"\"Run complete setup process\"\"\"\n        print(\"üé¨ Welcome to Smartclip AI Setup!\")\n        print(\"=\" * 50)\n        \n        # Check requirements\n        if not self.check_requirements():\n            print(\"\\n‚ùå Setup failed due to system requirements\")\n            return False\n            \n        # Install system dependencies\n        if not self.install_system_dependencies():\n            print(\"\\n‚ö†Ô∏è Warning: System dependencies may not be fully installed\")\n            \n        # Install pip requirements\n        if not self.install_pip_requirements():\n            print(\"\\n‚ùå Setup failed during package installation\")\n            return False\n            \n        # Setup directories\n        self.setup_directories()\n        \n        # Create launcher scripts\n        self.create_launcher_scripts()\n        \n        # Test installation\n        if not self.test_installation():\n            print(\"\\n‚ö†Ô∏è Installation test failed - some features may not work\")\n            \n        print(\"\\n\" + \"=\" * 50)\n        print(\"üéâ Smartclip AI setup completed successfully!\")\n        print(\"\\nüìñ Next steps:\")\n        print(\"   1. Run: python main.py\")\n        if self.system == \"Windows\":\n            print(\"   2. Or double-click: start_smartclip.bat\")\n        else:\n            print(\"   2. Or run: ./start_smartclip.sh\")\n        print(\"   3. Check README.md for detailed usage instructions\")\n        print(\"\\nüí° Tips:\")\n        print(\"   - First run akan download AI models (butuh internet)\")\n        print(\"   - Pastikan punya 10GB+ free space untuk temporary files\")\n        print(\"   - Gunakan GPU untuk performance optimal\")\n        print(\"\\nüöÄ Happy video processing!\")\n        \n        return True\n\ndef main():\n    installer = SmartclipInstaller()\n    \n    try:\n        success = installer.run_setup()\n        sys.exit(0 if success else 1)\n    except KeyboardInterrupt:\n        print(\"\\n\\n‚ö†Ô∏è Setup interrupted by user\")\n        sys.exit(1)\n    except Exception as e:\n        print(f\"\\n\\n‚ùå Unexpected error during setup: {e}\")\n        sys.exit(1)\n\nif __name__ == \"__main__\":\n    main()